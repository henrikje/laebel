{{ define "serviceGraph" }}
{{ $no_links := true }}
<pre class="mermaid">
---
config:
    fontFamily: "system-ui, sans-serif"
    fontSize: 15px
---
graph TD
{{ range . }}subgraph "{{ .Name | escape }}"
    direction LR{{ range .Services }}
    {{ .Name | escape }}[<a href="#{{ .Name }}">{{ if .Title }}{{ .Title }}{{ else }}{{ .Name }}{{ end }}</a>]{{ end }}
end
{{ end }}{{ range . }}{{ range .Services }}{{ $thisServiceName := .Name }}{{ range $index, $otherServiceName := .DependsOn }}{{ $no_links = false }}{{ $thisServiceName }} --> {{ $otherServiceName }}
{{ end }}{{ end }}{{ end }}
</pre>
{{ if $no_links }}
    <p class="hint">Hint: To add links to the graph, make sure your services declare <code>depends_on</code> relations.</p>
{{ end }}
{{ end }}