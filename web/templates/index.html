{{ define "index" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ if .Title }}{{ .Title }}{{ else }}{{ .Name }}{{ end }} – Laebel</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="icon" type="image/png" href="/static/img/laebel.svg">
    <script src="/static/js/htmx.min.js"></script>
    <script src="/static/js/sse.js"></script>
</head>
<body hx-ext="sse" sse-connect="/events?stream=updates" sse-close="close">
<header>
    <h1 class="title">
        {{ if .Logo }}<img src="{{ .Logo }}" alt="{{ .Name }} logo" id="logo">{{ end }}
        {{ if .Title }}{{ .Title }}{{ else }}<code>{{ .Name }}</code>{{ end }}
    </h1>
    {{ if .Description }}<p class="description">{{ .Description }}</p>{{ end }}
    {{ if .Links }}
        <ul>
            <li class="links">
                <strong>Links</strong>: {{ range $index, $link := .Links }}{{ if $index }}, {{ end }}<a
                href="{{ $link.URL }}">{{ $link.Title }}</a>{{end}}
            </li>
        </ul>
    {{ end }}
    <div id="brand" title="This documentation site is generated by Laebel.">
        <a href="https://github.com/henrikje/laebel"><img src="/static/img/laebel.svg" alt="Laebel logo" id="logo"></a>
        <p class="title"><a href="https://github.com/henrikje/laebel">Laebel</a></p>
    </div>
</header>
<main>
    <div id="error" class="warning" style="display: none">
        <h2>❗️ Failed to update status.</h2>
        <p>Cannot connect to the status update endpoint. Is the Laebel service running?</p>
        <p class="cta"><a href=".">Please reload the page to see the updated status.</a></p>
    </div>
    <script>
        document.body.addEventListener('htmx:sseError', () => {
            // Show the error message after a short delay to avoid flickering.
            setTimeout(() => document.getElementById('error').style.display = 'block', 500);
        })
        document.body.addEventListener('htmx:sseOpen', () => {
            document.getElementById('error').style.display = 'none';
        })
    </script>
    <div hx-trigger="sse:reload" hx-get="/reload"></div>
    {{ if .ServiceGroups }}
        <section id="graph">
            {{ template "serviceGraph" .ServiceGroups }}
        </section>
        {{ range .ServiceGroups }}
            <section class="group">
                <h2 class="title">{{ .Name }}</h2>
                {{ range .Services }}
                    {{ template "service" . }}
                {{ end }}
            </section>
        {{ end }}
        {{ if .Networks }}
            <section class="group">
                <h2 class="title">Networks</h2>
                {{ range .Networks }}
                    {{ template "network" . }}
                {{ end }}
            </section>
        {{ end }}
        {{ if .Volumes }}
            <section class="group">
                <h2 class="title">Volumes</h2>
                {{ range .Volumes }}
                    {{ template "volume" . }}
                {{ end }}
            </section>
        {{ end }}
    {{ else }}
        <p id="no-services">The {{ .Name }} project does not contain any services.</p>
    {{ end }}
</main>
<style hx-trigger="sse:status" hx-get="/graph-status.css" hx-swap="innerHTML">
    {{ template "serviceGraphStatus" . }}
</style>
</body>
<script type="module">
    import mermaid from '/static/js/mermaid.esm.min.mjs';
    mermaid.initialize();
</script>
<script>
    function copyPreviousText(button) {
        const previousElement = button.previousElementSibling;
        if (previousElement) {
            const text = previousElement.textContent;
            navigator.clipboard.writeText(text)
        }
    }
</script>
</html>
{{ end }}